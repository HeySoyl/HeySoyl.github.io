<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Swift   Dictionary数据结构"><meta name="keywords" content="Basis"><meta name="author" content="Soyl"><meta name="copyright" content="Soyl"><title>Swift   Dictionary数据结构 | Soyl's Blog</title><link rel="shortcut icon" href="/Icon.png"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.9.0/css/all.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="manifest" href="/manifest.json"><link rel="manifest" href="/manifest.json"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: 'ca-pub-5485968112876534',
  enable_page_level_ads: 'true'
});
</script><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?aa8f97cc0791747be9d3abce013ed1c7";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', '132783894', 'auto');
ga('send', 'pageview');</script><link rel="dns-prefetch" href="http://ta.qq.com"><script>(function() {
   var hm = document.createElement("script");
   hm.src = "https://tajs.qq.com/stats?sId=66455759";
   var s = document.getElementsByTagName("script")[0];
   s.parentNode.insertBefore(hm, s);
 })();</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#定义Dictionary"><span class="toc-number">1.</span> <span class="toc-text">定义Dictionary</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常用的基本属性"><span class="toc-number">2.</span> <span class="toc-text">常用的基本属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#添加、更新和删除元素"><span class="toc-number">3.</span> <span class="toc-text">添加、更新和删除元素</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#遍历Dictionary"><span class="toc-number">4.</span> <span class="toc-text">遍历Dictionary</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#合并进不同的设置"><span class="toc-number">5.</span> <span class="toc-text">合并进不同的设置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#merge"><span class="toc-number">5.1.</span> <span class="toc-text">merge</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#用一个tuple数组初始化Dictionary"><span class="toc-number">5.2.</span> <span class="toc-text">用一个tuple数组初始化Dictionary</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#定制map的行为"><span class="toc-number">5.3.</span> <span class="toc-text">定制map的行为</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Soyl</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/HeySoyl" target="_blank" rel="noopener">Follow ME</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">36</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">19</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">21</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Soyl's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/about">About</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">Swift   Dictionary数据结构</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-02-18</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Swift/">Swift</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">2.3k</span><span class="post-meta__separator">|</span><span>Reading time: 8 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>Dictionary是除了Array之外的另一种非常重要的数据结构，它用于把某种形式的key，关联到某种形式的value。我们来看一个例子。</p>
<a id="more"></a>

<h2 id="定义Dictionary"><a href="#定义Dictionary" class="headerlink" title="定义Dictionary"></a>定义Dictionary</h2><p>假设我们要定义一个数据结构，用来保存用户在泊学对某个视频的观看情况。可以这样：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">假设我们要定义一个数据结构，用来保存用户在泊学对某个视频的观看情况。可以这样：</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">RecordType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> bool(<span class="type">Bool</span>)</span><br><span class="line">    <span class="keyword">case</span> number(<span class="type">Int</span>)</span><br><span class="line">    <span class="keyword">case</span> text(<span class="type">String</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> record11: [<span class="type">String</span>: <span class="type">RecordType</span>] = [</span><br><span class="line">    <span class="string">"uid"</span>: .number(<span class="number">11</span>),</span><br><span class="line">    <span class="string">"exp"</span>: .number(<span class="number">100</span>),</span><br><span class="line">    <span class="string">"favourite"</span>: .bool(<span class="literal">true</span>),</span><br><span class="line">    <span class="string">"title"</span>: .text(<span class="string">"Dictionary basics"</span>)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>在上面代码里，我们用[KeyType: ValueType]的形式来定义一个Dictionary。当定义好Dictionary之后，我们就能直接用[Key]来访问某个key对应的值了：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">record11[<span class="string">"uid"</span>]       <span class="comment">// number(11)</span></span><br><span class="line">record11[<span class="string">"favourite"</span>] <span class="comment">// bool(true)</span></span><br><span class="line">record11[<span class="string">"title"</span>]     <span class="comment">// text("Dictionary basics")</span></span><br><span class="line">record11[<span class="string">"invalid"</span>]   <span class="comment">// nil</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Optional&lt;RecordType&gt;.Type</span></span><br><span class="line">type(of: record11[<span class="string">"favourite"</span>])</span><br></pre></td></tr></table></figure>
<p>上面例子中的结果都很直观。但是有一个细节却是值得我们注意的。和Array不同的是，[]用在Dictionary的时候，会返回一个Optional类型来确保这种形式的访问安全。因此，访问不存在的key，并不会导致运行时错误。</p>
<p>这是因为索引这个概念，对Array和Dictionary来说，是截然不同的。对于Array来说，我们有可能使用的正常索引值只源于Array自身，也就是0..&lt;array.count，因此，如果你使用了不在这个范围里的值，则一定是可以被定性为Bug的，何况，我们之前也看到了，对于Array，我们几乎不需要直接使用索引来访问元素。</p>
<p>而对于Dictionary来说，它包含的内容并不直接决定我们可以查询的内容。举个例子来说，英汉词典中也可能并不包含我们要查询的单词。所以，Dictionary中包含的所有键值，从语义上说，并不完全决定了它的使用者会查询的值，所以，我们也无法把这类问题明确的归因于是Bug。所以，Swfit为Dictionary的索引查询操作，提供了optional保护。要么得到正确的结果，要么通过nil表示要查询的内容不存在。</p>
<h2 id="常用的基本属性"><a href="#常用的基本属性" class="headerlink" title="常用的基本属性"></a>常用的基本属性</h2><p>作为一个集合类型，Dictionary同样有count和isEmpty两个属性读取其元素的个数以及判断其是否为空：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">record11.<span class="built_in">count</span>   <span class="comment">// 4</span></span><br><span class="line">record11.isEmpty <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>另外，我们可以单独访问一个Dictionary的所有keys和所有values：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">record11.keys</span><br><span class="line">record11.values</span><br></pre></td></tr></table></figure>
<p>这两个属性也分别是一个集合，我们可以暂时忽略掉它们具体的类型，如果要我们要访问它们的每一个元素，直接用for循环或forEach遍历就好了：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> record11.keys &#123; <span class="built_in">print</span>(key) &#125;</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">record11.keys.forEach &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</span><br></pre></td></tr></table></figure>
<h2 id="添加、更新和删除元素"><a href="#添加、更新和删除元素" class="headerlink" title="添加、更新和删除元素"></a>添加、更新和删除元素</h2><p>和Array一样，Dictionary也是一个值类型，当我们复制Dictionary对象的时候，就会拷贝Dictionary中的所有内容：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> record10 = record11</span><br></pre></td></tr></table></figure>
<p>并且，直接使用key就可以访问和修改Dictionary的内容：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">record10[<span class="string">"favourite"</span>] = .bool(<span class="literal">false</span>) <span class="comment">// false</span></span><br><span class="line">record11[<span class="string">"favourite"</span>] <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>如果我们希望更新value的时候，同时获得修改前的值，还可以使用updateValue(_:forKey:)方法：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">record10.updateValue(.bool(<span class="literal">true</span>),</span><br><span class="line">    forKey: <span class="string">"favourite"</span>) <span class="comment">// .bool(false)</span></span><br></pre></td></tr></table></figure>
<p>从上面的结果可以看出修改record10并不会影响record11。</p>
<p>当我们要在Dictionary中添加元素时，直接给要添加的key赋值就好了：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">record10[<span class="string">"watchLater"</span>] = .bool(<span class="literal">false</span>)</span><br><span class="line"><span class="comment">// [</span></span><br><span class="line"><span class="comment">//  "favourite": RecordType.bool(false),</span></span><br><span class="line"><span class="comment">//  "exp": RecordType.number(100),</span></span><br><span class="line"><span class="comment">//  "title": RecordType.text("Directory basics"),</span></span><br><span class="line"><span class="comment">//  "uid": RecordType.number(11),</span></span><br><span class="line"><span class="comment">//  "watchLater": RecordType.bool(false)</span></span><br><span class="line"><span class="comment">// ]</span></span><br></pre></td></tr></table></figure>
<p>这样，record10中的内容，就变成了5项。而当我们要删除特定的key时，直接把它的值设置为nil：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">record10[<span class="string">"watchLater"</span>] = <span class="literal">nil</span></span><br><span class="line"><span class="comment">// [</span></span><br><span class="line"><span class="comment">//  "favourite": RecordType.bool(false),</span></span><br><span class="line"><span class="comment">//  "exp": RecordType.number(100),</span></span><br><span class="line"><span class="comment">//  "title": RecordType.text("Directory basics"),</span></span><br><span class="line"><span class="comment">//  "uid": RecordType.number(11)</span></span><br><span class="line"><span class="comment">// ]</span></span><br></pre></td></tr></table></figure>
<p>这里，并不是把特定key的值设置为nil（毕竟Dictionary中value部分的类型也不是optional），而是删除特定的key。当某个key的value被设置成nil后，这个key也就从Dictionary中删除了。</p>
<h2 id="遍历Dictionary"><a href="#遍历Dictionary" class="headerlink" title="遍历Dictionary"></a>遍历Dictionary</h2><p>由于Dictionary同时包含了key和value，因此，我们也有多重方式来遍历Dictionary。最简单的，就是遍历Dictionary中的每一个元素：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (k, v) <span class="keyword">in</span> record10 &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\(k): \(v)"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//or</span></span><br><span class="line">record10.forEach &#123; <span class="built_in">print</span>(<span class="string">"\($0): \($1)"</span>) &#125;</span><br></pre></td></tr></table></figure>
<p>从上面的例子可以看到，遍历Dictionary和遍历Array是类似的。当我们使用for循环遍历时，它的每一个元素都用一个tuple来表示，封装了每一个元素的key和value。而当使用forEach方法时，它会给它的closure参数传递两个值，分别是每一个元素的key和value。<br>[^<em>^]: #  (但是，由于Dictionary是一个无序集合（unordered collection），因此当我们编辑了Dictionary之后，每次遍历，访问元素的顺序都可能是不同的。如果我们希望按照固定的顺序来访问Dictionary中的元素，一个最简单的办法，就是对key排序后，再进行遍历：)<br>[^</em>^]: #  (for key in record10.keys.sorted() {print(“(key): (record10[key])”)})</p>
<h2 id="合并进不同的设置"><a href="#合并进不同的设置" class="headerlink" title="合并进不同的设置"></a>合并进不同的设置</h2><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">RecordType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> bool(<span class="type">Bool</span>)</span><br><span class="line">    <span class="keyword">case</span> number(<span class="type">Int</span>)</span><br><span class="line">    <span class="keyword">case</span> text(<span class="type">String</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> defaultRecord: [<span class="type">String</span>: <span class="type">RecordType</span>] = [</span><br><span class="line">    <span class="string">"uid"</span>: .number(<span class="number">0</span>),</span><br><span class="line">    <span class="string">"exp"</span>: .number(<span class="number">100</span>),</span><br><span class="line">    <span class="string">"favourite"</span>: .bool(<span class="literal">false</span>),</span><br><span class="line">    <span class="string">"title"</span>: .text(<span class="string">""</span>)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>这样，当创建新纪录时，我们希望保持默认记录中的默认值，同时合并进不同用户的设置，例如：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> template = defaultRecord</span><br><span class="line"><span class="keyword">var</span> record11Patch: [<span class="type">String</span>: <span class="type">RecordType</span>] = [</span><br><span class="line">    <span class="string">"uid"</span>: .number(<span class="number">11</span>),</span><br><span class="line">    <span class="string">"title"</span>: .text(<span class="string">"Common dictionary extensions"</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// How can we do this?</span></span><br><span class="line"><span class="comment">// template.merge(record11Patch)</span></span><br><span class="line"><span class="comment">// [</span></span><br><span class="line"><span class="comment">//    uid: .number(11),</span></span><br><span class="line"><span class="comment">//    "exp": .number(100),</span></span><br><span class="line"><span class="comment">//    "favourite": .bool(false),</span></span><br><span class="line"><span class="comment">//    "title": .text("Common dictionary extensions")</span></span><br><span class="line"><span class="comment">// ]</span></span><br></pre></td></tr></table></figure>
<h3 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h3><p>然而，该如何实现这个merge呢？最重要的事情，就是要想一下什么内容可以被merge进来。最一般的情况来说，无论任何形式的序列，只要它的元素中key和value的类型和Dictionary相同，就可以进行合并。</p>
<p>如何在代码中表达这个特征呢？来看下面的例子：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Dictionary</span> </span>&#123;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">merge</span>&lt;S:Sequence&gt;<span class="params">(<span class="number">_</span> sequence: S)</span></span></span><br><span class="line">        <span class="keyword">where</span> <span class="type">S</span>.<span class="type">Iterator</span>.<span class="type">Element</span> == (key: <span class="type">Key</span>, value: <span class="type">Value</span>) &#123;</span><br><span class="line"></span><br><span class="line">        sequence.forEach &#123; <span class="keyword">self</span>[$<span class="number">0</span>] = $<span class="number">1</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于Dictionary是一个struct，并且merge修改了self，我们必须使用mutating关键字修饰这个方法。而对于sequence参数，我们通过where关键字限定了两个内容：</p>
<ul>
<li>S必须遵从Sequence protocol，Dictionary是众多遵从了Sequence protocol的collection类型之一，但是，我们没必要一定只能合并Dictionary；</li>
<li>S的元素类型必须和原Dictionary的Element相同，其中Key和Value是Dictionary声明中的两个泛型参数；<br>解决了参数问题之后，实现合并的算法就很简单了，我们只是更新self中每一个和sequence有相同key的值就好了。</li>
</ul>
<p>这样，之前template.merge(record11Patch)就可以正常工作了。</p>
<p>既然，我们把merge参数的约束定义为了Sequence，那我们就来看一个合并非Dictionary类型的情况，例如，合并一个包含正确内容的Array：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> record10Patch: [(key: <span class="type">String</span>, value: <span class="type">RecordType</span>)] = [</span><br><span class="line">    (key: <span class="string">"uid"</span>,   value: .number(<span class="number">10</span>)),</span><br><span class="line">    (key: <span class="string">"title"</span>, value: .text(<span class="string">"Common dictionary extensions"</span>))</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> template1 = defaultRecord</span><br><span class="line">template1.merge(record10Patch)</span><br><span class="line"><span class="comment">// [</span></span><br><span class="line"><span class="comment">//    uid: .number(10),</span></span><br><span class="line"><span class="comment">//    "exp": .number(100),</span></span><br><span class="line"><span class="comment">//    "favourite": .bool(false),</span></span><br><span class="line"><span class="comment">//    "title": .text("Common dictionary extensions")</span></span><br><span class="line"><span class="comment">// ]</span></span><br></pre></td></tr></table></figure>

<p>在上面的代码里，我们合并了一个tuple数组，它的类型是Array&lt;String, RecordType&gt;，数组中的每一项都包含了一个要合并进来的键值对。如果没有意外，合并Array和Dictionary都应该是可以正常工作的。</p>
<p>按照我们对merge的实现方式，实际上，任何一个遵从了Sequence protocol的类型，只要它包含了和template相同的元素类型，都是可以merge的。</p>
<h3 id="用一个tuple数组初始化Dictionary"><a href="#用一个tuple数组初始化Dictionary" class="headerlink" title="用一个tuple数组初始化Dictionary"></a>用一个tuple数组初始化Dictionary</h3><p>理解了merge的实现和用法之后，其实，我们很容易把这个场景进一步扩展下，如果我们可以merge类型兼容的Sequence，那么，用这样的Sequence来初始化一个Dictionary也是可以的，把它看成是和一个空的Dictionary进行合并就好了：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Dictionary</span> </span>&#123;</span><br><span class="line">    <span class="keyword">init</span>&lt;<span class="type">S</span>:<span class="type">Sequence</span>&gt;(<span class="number">_</span> sequence: <span class="type">S</span>)</span><br><span class="line">        <span class="keyword">where</span> <span class="type">S</span>.<span class="type">Iterator</span>.<span class="type">Element</span> == (key: <span class="type">Key</span>, value: <span class="type">Value</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span> = [:]</span><br><span class="line">        <span class="keyword">self</span>.merge(sequence)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有了这个方法之后，我们直接用下面的代码就可以创建一个新的Dictionary对象：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> record11 = <span class="type">Dictionary</span>(record11Patch)</span><br><span class="line"><span class="comment">// [</span></span><br><span class="line"><span class="comment">//    uid: .number(11),</span></span><br><span class="line"><span class="comment">//    "title": .text("Common dictionary extensions")</span></span><br><span class="line"><span class="comment">// ]</span></span><br></pre></td></tr></table></figure>

<h3 id="定制map的行为"><a href="#定制map的行为" class="headerlink" title="定制map的行为"></a>定制map的行为</h3><p>最后一个要介绍的常用功能，是定制Dictionary.map的行为，默认情况下它返回的是一个Array，例如：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">record11.<span class="built_in">map</span> &#123; $<span class="number">1</span> &#125;</span><br><span class="line"><span class="comment">// [ .number(11).text("Common dictionary extensions")]</span></span><br></pre></td></tr></table></figure>
<p>在上面的例子里，map返回一个Array<RecordType>，但有时，我们仅仅希望对value做一些变换，而仍旧保持Dictionary的类型。为此，我们可以自定义一个“只map value”的方法：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">们可以自定义一个“只<span class="built_in">map</span> value”的方法：</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Dictionary</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">mapValue</span>&lt;T&gt;<span class="params">(<span class="number">_</span> transform: <span class="params">(Value)</span></span></span> -&gt; <span class="type">T</span>) -&gt; [<span class="type">Key</span>: <span class="type">T</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Dictionary</span>&lt;<span class="type">Key</span>, <span class="type">T</span>&gt;(<span class="built_in">map</span> &#123; (k, v) <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">return</span> (k, transform(v))</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个实现的最内部，我们用标准库中的map得到了一个Array&lt;(String, RecordType)&gt;类型的Array，而后，由于Array也遵从了Sequence protocol，因此，我们就能直接使用这个Array来定义新的Dictionary了。</p>
<p>完成之后，用下面的代码测试下：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> newRecord11 = record11.mapValue &#123; record -&gt; <span class="type">String</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">switch</span> record &#123;</span><br><span class="line">    <span class="keyword">case</span> .text(<span class="keyword">let</span> title):</span><br><span class="line">        <span class="keyword">return</span> title</span><br><span class="line">    <span class="keyword">case</span> .number(<span class="keyword">let</span> exp):</span><br><span class="line">        <span class="keyword">return</span> <span class="type">String</span>(exp)</span><br><span class="line">    <span class="keyword">case</span> .bool(<span class="keyword">let</span> favourite):</span><br><span class="line">        <span class="keyword">return</span> <span class="type">String</span>(favourite)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// [</span></span><br><span class="line"><span class="comment">//    "uid": "11",</span></span><br><span class="line"><span class="comment">//    "title": "Common dictionary extensions"</span></span><br><span class="line"><span class="comment">// ]</span></span><br><span class="line">这样，我们就用record11生成了一个<span class="type">Dictionary</span>&lt;<span class="type">String</span>, <span class="type">String</span>&gt;类型的对象。</span><br></pre></td></tr></table></figure></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Soyl</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://soyl.tech/zh-cn/Swift/swift_dicrionary.html">https://soyl.tech/zh-cn/Swift/swift_dicrionary.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://heysoyl.com/licenses/cn-hey-s/1.0/" target="_blank" rel="noopener">CN HEY S 1.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Basis/">Basis</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/zh-cn/APP/Shadowsocks/macos10_12_shadowsocks.html"><i class="fa fa-chevron-left">  </i><span>MacOS 10.12 终端命令行下使用Shadowsocks</span></a></div><div class="next-post pull-right"><a href="/zh-cn/Swift/swift_array_study.html"><span>Swift：Array</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="lv-container" data-id="city" data-uid="MTAyMC80NTI1NS8yMTc3MA=="><script>(function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
})(document, 'script');</script></div></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2015 - 2020 By Soyl</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="footer_custom_text">鲁ICP备19002969号</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"superSample":2,"width":210,"height":420,"position":"left","hOffset":0,"vOffset":-20},"log":false,"tagMode":false});</script></body></html>